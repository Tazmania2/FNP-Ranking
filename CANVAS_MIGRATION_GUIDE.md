# üé® Guia de Migra√ß√£o: ChickenRace para ChickenRaceCanvas

## üìã Vis√£o Geral

Este guia ajuda voc√™ a migrar do componente `ChickenRace` (DOM-based) para `ChickenRaceCanvas` (Canvas-based) para obter melhor performance.

## üéØ Por que migrar?

### Benef√≠cios
- **Performance 2x melhor**: 60 FPS consistentes vs ~30 FPS com muitos jogadores
- **10x menos mem√≥ria**: Um canvas vs centenas de elementos DOM
- **Melhor em mobile**: Renderiza√ß√£o muito mais leve
- **Escal√°vel**: Suporta 100+ jogadores sem lag

### Trade-offs
- **CSS customizado**: Menos flex√≠vel que DOM
- **SEO**: Canvas n√£o √© indexado (mas voc√™ tem os stats abaixo)
- **Screen readers**: Acessibilidade reduzida (mas tooltips ainda funcionam)

## üöÄ Migra√ß√£o R√°pida (5 minutos)

### 1. Atualiza√ß√£o Simples

**Antes:**
```typescript
import { ChickenRace } from './components/ChickenRace';

<ChickenRace
  players={players}
  leaderboardTitle="Meu Ranking"
  isLoading={false}
/>
```

**Depois:**
```typescript
import { ChickenRaceCanvas } from './components/ChickenRaceCanvas';

<ChickenRaceCanvas
  players={players}
  leaderboardTitle="Meu Ranking"
  isLoading={false}
/>
```

‚úÖ **√â isso! A API √© 100% compat√≠vel.**

### 2. Props Compat√≠veis

Todas as props funcionam exatamente igual:

```typescript
interface ChickenRaceProps {
  players: Player[];              // ‚úÖ Mesma
  leaderboardTitle: string;       // ‚úÖ Mesma
  isLoading: boolean;             // ‚úÖ Mesma
  playerPositions?: Array<{       // ‚úÖ Mesma
    playerId: string;
    position: { x: number; y: number };
    rank: number;
    isAnimating: boolean;
  }>;
  isFullscreen?: boolean;         // ‚úÖ Mesma
}
```

## üì¶ Exemplos de Migra√ß√£o

### Exemplo 1: Uso B√°sico

```typescript
// ‚ùå Antes (DOM)
import ChickenRace from './components/ChickenRace';

function MyLeaderboard() {
  return (
    <ChickenRace
      players={players}
      leaderboardTitle="Top Players"
      isLoading={loading}
    />
  );
}

// ‚úÖ Depois (Canvas)
import ChickenRaceCanvas from './components/ChickenRaceCanvas';

function MyLeaderboard() {
  return (
    <ChickenRaceCanvas
      players={players}
      leaderboardTitle="Top Players"
      isLoading={loading}
    />
  );
}
```

### Exemplo 2: Com Hooks Customizados

```typescript
// ‚ùå Antes (DOM)
import { ChickenRace } from './components';
import { useChickenRaceManager } from './hooks';

function MyRace() {
  const { players, isLoading } = useChickenRaceManager();
  
  return (
    <ChickenRace
      players={players}
      leaderboardTitle="Racing"
      isLoading={isLoading}
    />
  );
}

// ‚úÖ Depois (Canvas) - NADA MUDA!
import { ChickenRaceCanvas } from './components';
import { useChickenRaceManager } from './hooks';

function MyRace() {
  const { players, isLoading } = useChickenRaceManager();
  
  return (
    <ChickenRaceCanvas
      players={players}
      leaderboardTitle="Racing"
      isLoading={isLoading}
    />
  );
}
```

### Exemplo 3: Com Player Positions

```typescript
// ‚ùå Antes (DOM)
<ChickenRace
  players={players}
  leaderboardTitle="Custom Race"
  isLoading={false}
  playerPositions={customPositions}
/>

// ‚úÖ Depois (Canvas) - MESMA COISA!
<ChickenRaceCanvas
  players={players}
  leaderboardTitle="Custom Race"
  isLoading={false}
  playerPositions={customPositions}
/>
```

### Exemplo 4: Modo Fullscreen

```typescript
// ‚ùå Antes (DOM)
<ChickenRace
  players={players}
  leaderboardTitle="TV Mode"
  isLoading={false}
  isFullscreen={true}
/>

// ‚úÖ Depois (Canvas) - FUNCIONA IGUAL!
<ChickenRaceCanvas
  players={players}
  leaderboardTitle="TV Mode"
  isLoading={false}
  isFullscreen={true}
/>
```

## üîÑ Migra√ß√£o Gradual (Recomendado)

### Estrat√©gia A/B Testing

Use ambas as vers√µes em paralelo:

```typescript
import { ChickenRace } from './components/ChickenRace';
import { ChickenRaceCanvas } from './components/ChickenRaceCanvas';

function MyLeaderboard() {
  const [useCanvas, setUseCanvas] = useState(false);
  
  // Toggle para testar
  const RaceComponent = useCanvas ? ChickenRaceCanvas : ChickenRace;
  
  return (
    <>
      <button onClick={() => setUseCanvas(!useCanvas)}>
        Alternar vers√£o ({useCanvas ? 'Canvas' : 'DOM'})
      </button>
      
      <RaceComponent
        players={players}
        leaderboardTitle="Test Race"
        isLoading={false}
      />
    </>
  );
}
```

### Migra√ß√£o por Feature Flag

```typescript
import { ChickenRace } from './components/ChickenRace';
import { ChickenRaceCanvas } from './components/ChickenRaceCanvas';

function MyLeaderboard() {
  // Pode vir de env var, remote config, etc
  const FEATURE_CANVAS = process.env.REACT_APP_USE_CANVAS === 'true';
  
  const RaceComponent = FEATURE_CANVAS ? ChickenRaceCanvas : ChickenRace;
  
  return (
    <RaceComponent
      players={players}
      leaderboardTitle="Race"
      isLoading={false}
    />
  );
}
```

## üß™ Testando a Migra√ß√£o

### 1. Teste Visual

```typescript
// Compare lado a lado
<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
  <div>
    <h3>DOM (Original)</h3>
    <ChickenRace {...props} />
  </div>
  <div>
    <h3>Canvas (Novo)</h3>
    <ChickenRaceCanvas {...props} />
  </div>
</div>
```

### 2. Teste de Performance

```typescript
import { Profiler } from 'react';

function onRender(id, phase, actualDuration) {
  console.log(`${id} (${phase}) took ${actualDuration}ms`);
}

<Profiler id="ChickenRace" onRender={onRender}>
  <ChickenRaceCanvas {...props} />
</Profiler>
```

### 3. Teste de Interatividade

Checklist:
- [ ] Hover nas galinhas mostra tooltip
- [ ] Click nas galinhas mostra tooltip
- [ ] Tooltip fecha ao clicar fora
- [ ] Anima√ß√µes est√£o suaves (60fps)
- [ ] Posicionamento est√° correto
- [ ] Fullscreen funciona
- [ ] Responsivo em mobile

## üêõ Troubleshooting

### Problema: Canvas est√° borrado

**Causa**: Device pixel ratio n√£o configurado

**Solu√ß√£o**: J√° est√° resolvido! O hook `useCanvasRenderer` ajusta automaticamente.

### Problema: Tooltips n√£o aparecem

**Causa**: Z-index ou hitbox detection

**Solu√ß√£o**: Verifique se o canvas est√° recebendo eventos mouse:
```typescript
// No ChickenRaceCanvas.tsx
<canvas
  ref={canvasRef}
  className="absolute inset-0"
  onMouseMove={handleMouseMove}  // ‚úÖ Certifique-se que est√° aqui
  onClick={handleClick}           // ‚úÖ E aqui
/>
```

### Problema: Performance pior que DOM

**Causa**: Muitas re-renderiza√ß√µes ou canvas muito grande

**Solu√ß√£o**:
1. Use `React.memo` no componente pai
2. Verifique se props est√£o mudando desnecessariamente
3. Reduza tamanho do canvas se poss√≠vel

### Problema: Anima√ß√µes travando no mobile

**Causa**: Device muito antigo

**Solu√ß√£o**:
```typescript
// Detectar mobile e reduzir taxa de atualiza√ß√£o
const isMobile = /iPhone|iPad|Android/i.test(navigator.userAgent);
const targetFPS = isMobile ? 30 : 60;
```

## üìä M√©tricas de Sucesso

Ap√≥s migra√ß√£o, voc√™ deve ver:

| M√©trica | Antes (DOM) | Depois (Canvas) | Meta |
|---------|-------------|-----------------|------|
| FPS | ~30-45 | 60 | ‚úÖ 60 FPS |
| Tempo inicial | ~200ms | ~20ms | ‚úÖ < 50ms |
| Mem√≥ria | ~50MB | ~5MB | ‚úÖ < 10MB |
| CPU uso | ~40% | ~10% | ‚úÖ < 15% |

### Como medir

```javascript
// FPS
let lastTime = performance.now();
let frameCount = 0;

requestAnimationFrame(function measureFPS() {
  frameCount++;
  const now = performance.now();
  if (now >= lastTime + 1000) {
    console.log(`FPS: ${frameCount}`);
    frameCount = 0;
    lastTime = now;
  }
  requestAnimationFrame(measureFPS);
});

// Mem√≥ria (Chrome DevTools)
// 1. Abra DevTools
// 2. Performance > Memory
// 3. Record > Interaja com app > Stop
// 4. Veja heap size
```

## üéì Checklist de Migra√ß√£o

- [ ] Backup do c√≥digo atual
- [ ] Instalar/importar `ChickenRaceCanvas`
- [ ] Substituir imports
- [ ] Testar visualmente
- [ ] Testar interatividade (hover, click)
- [ ] Testar responsividade
- [ ] Testar em mobile
- [ ] Medir performance
- [ ] Deploy em staging
- [ ] Teste A/B (opcional)
- [ ] Deploy em produ√ß√£o
- [ ] Monitorar m√©tricas
- [ ] Remover c√≥digo antigo (ap√≥s valida√ß√£o)

## üöÄ Pr√≥ximos Passos

1. **Teste em staging**: Valide que tudo funciona
2. **A/B test**: Compare m√©tricas reais
3. **Gradual rollout**: 10% ‚Üí 50% ‚Üí 100% dos usu√°rios
4. **Monitore**: Erros, performance, engagement
5. **Itere**: Baseado em feedback

## üí° Dicas Pro

1. **Mantenha ambas as vers√µes** durante rollout
2. **Use feature flags** para rollback r√°pido
3. **Monitore m√©tricas** de perto nas primeiras 48h
4. **Colete feedback** de usu√°rios
5. **Documente problemas** e solu√ß√µes

## üìö Recursos

- [README-Canvas.md](./src/components/README-Canvas.md) - Documenta√ß√£o t√©cnica completa
- [ChickenRaceCanvasExample.tsx](./src/components/examples/ChickenRaceCanvasExample.tsx) - Exemplo de uso
- [Canvas API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API)

## üÜò Suporte

Encontrou problemas? 

1. Verifique o [Troubleshooting](#-troubleshooting)
2. Leia o [README-Canvas.md](./src/components/README-Canvas.md)
3. Abra uma issue no projeto
4. Considere voltar para vers√£o DOM temporariamente

---

**Boa sorte com a migra√ß√£o! üéâ**

*A performance do seu app agradece.* üöÄ

